<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale-1.0">
    <title>Detalle del Ticket - <%= ticket.Establecimiento %></title>
    <link rel="stylesheet" href="<%= basePath %>/css/style.css">
</head>
<body>
    <div class="container">
        <header class="app-header">
            <h1>CAPTia</h1>
            <button class="menu-toggle" id="menuToggle">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <nav id="mainNav">
                <a href="<%= basePath %>/">Escanear</a>
                <a href="<%= basePath %>/tickets">Mis Tickets</a>
                <a href="<%= basePath %>/productos">Productos</a>
            </nav>
        </header>

        <main class="detail-card">
            <div class="detail-header">
                <h2><%= ticket.Establecimiento %></h2>
                <p>
                    <strong>Fecha:</strong> 
                    <%= ticket.Fecha ? new Date(ticket.Fecha).toLocaleDateString('es-ES') : 'No especificada' %>
                </p>
            </div>
            
            <h3 class="product-list-header">Productos Comprados</h3>
            <div class="ticket-body">
                <ul>
                    <% if (productos.length > 0) { %>
                        <% productos.forEach(prod => { %>
                            <li>
                                <span class="prod-desc"><%= prod.Unidades %> x <%= prod.Producto %></span>
                                <span class="prod-price"><%= ((prod.Unidades || 0) * (prod.Precio_Unitario || 0)).toFixed(2) %> €</span>
                            </li>
                        <% }); %>
                    <% } else { %>
                        <li>No hay productos asociados a este ticket.</li>
                    <% } %>
                </ul>
            </div>
            <div class="ticket-footer">
                <strong>Total: <%= (ticket.total || 0).toFixed(2) %> €</strong>
            </div>

            <div style="margin-top: 20px; text-align: center;">
                <form action="<%= basePath %>/ticket/<%= ticket.id %>/delete" method="POST" onsubmit="return confirm('¿Estás seguro de que quieres borrar este ticket? Esta acción no se puede deshacer.');" style="display: inline;">
                    <button type="submit" class="delete-btn">Borrar Ticket</button>
                </form>
                <a href="<%= basePath %>/tickets" class="back-btn">Volver a Mis Tickets</a>
            </div>
        </main>
    </div>
    <script>
        // Mobile menu toggle
        const menuToggle = document.getElementById('menuToggle');
        const mainNav = document.getElementById('mainNav');

        if (menuToggle) {
            menuToggle.addEventListener('click', function() {
                this.classList.toggle('active');
                mainNav.classList.toggle('active');
            });
        }
    </script>
</body>
</html>